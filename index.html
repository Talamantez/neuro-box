<!DOCTYPE html>
<html lang="en">

<head>
    <title>Neuro-Draggable-Cubes WebGL Three.js</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta charset="UTF-8">
    <title></title>
    <!-- jquery-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <style>
    canvas {
        height: 0;
    }

    .container {
        font-family: 'Raleway', sans-serif;
        width: 100%;
        position: absolute;
    }

    .formPanel {
        margin: 0 auto;
        width: 80%;
        border: 2px solid black;
    }

    .formInput {
        display: block;
        width: 50%;
        margin: 1em;
    }

    form {
        padding: 2em 0 0 0;
        z-index: 100;
    }

    .intro {
        text-align: center;
        background-color: #637a91;
        color: white;
        letter-spacing: .1em;
        padding-top: .7em;
        height: 3em;
    }

    .green {
        background-color: #5fcf80;
        color: white;
        letter-spacing: .1em;
        margin-top: 1em;
        width: 80%;
        margin: 0 auto;
    }

    .password {
        margin-bottom: 3em;
    }

    .foot {
        font-size: 10px;
        padding: 1em;
        padding-left: 11%;
    }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/kefir/3.8.0/kefir.js"></script>
    <script src="https://unpkg.com/react@15.6.1/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15.6.1/dist/react-dom.js"></script>
    <script src="./app.js"></script>
</head>

<body>
    <div class="container">
        <div class="row formPanel">
            <div class="intro">Get Started Today!</div>
            <form action="/" method="post" onsubmit="function(target){target.preventDefault();console.log('things happening');return false;}">
                <div class="col-xs-6 formInput">
                    <label for="form-control">form control</label>
                    <input id="form-control" class="form-control" autofocus="true">
                </div>
        </div>
        <input type="submit" class="form-control green" value="submit this message">
        <div class="foot">
            You are agreeing to our <a href="#">Terms of Service</a>
        </div>
        </form>
    </div>
    </div>
    <div class="container">
        <script src="./node_modules/three/build/three.js"></script>
        <script src="./node_modules/three/examples/js/controls/DragControls.js"></script>
        <script src="./node_modules/three/examples/js/controls/TrackballControls.js"></script>
        <script src="./node_modules/three/examples/js/libs/stats.min.js"></script>
        <script>
        var container, stats;
        var camera, controls, scene, renderer, geometry, difference;
        var objects = [];
        var loopCount = 0;
        var masterscope = {};

        init();
        animate();

        function init() {

            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 1000;

            controls = new THREE.TrackballControls(camera);
            controls.rotateSpeed = 1.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;
            controls.noZoom = false;
            controls.noPan = false;
            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);

            scene.add(new THREE.AmbientLight(0x505050));

            var light = new THREE.SpotLight(0xffffff, 1.5);
            light.position.set(0, 500, 2000);
            light.castShadow = true;

            light.shadow = new THREE.LightShadow(new THREE.PerspectiveCamera(50, 1, 200, 10000));
            light.shadow.bias = -0.00022;

            light.shadow.mapSize.width = 2048;
            light.shadow.mapSize.height = 2048;

            scene.add(light);

            geometry = new THREE.BoxGeometry(40, 40, 40);

            // drawCubes(geometry);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);

            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFShadowMap;

            container.appendChild(renderer.domElement);

            var dragControls = new THREE.DragControls(objects, camera, renderer.domElement);
            dragControls.addEventListener('dragstart', function(event) { controls.enabled = false; });
            dragControls.addEventListener('dragend', function(event) { controls.enabled = true; });

            var info = document.createElement('div');
            info.style.position = 'absolute';
            info.style.top = '10px';
            info.style.width = '100%';
            info.style.textAlign = 'center';
            container.appendChild(info);

            stats = new Stats();
            container.appendChild(stats.dom);

            //

            window.addEventListener('resize', onWindowResize, false);

        }

        function drawCubes(geometry, attention) {
            // for (var i = 0; i < objects.length; i++) {
            //     scene.remove(objects[i]);
            // }
            console.log('testAttention: ' + testAttention);
            console.log('attention: ' + attention);
            if (loopCount === 0) {
                for (var i = 0; i < attention; i++) {

                    var object = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({ color: Math.random() * 0xffffff }));

                    object.position.x = Math.random() * 1000 - 500;
                    object.position.y = Math.random() * 600 - 300;
                    object.position.z = Math.random() * 800 - 400;

                    object.rotation.x = Math.random() * 2 * Math.PI;
                    object.rotation.y = Math.random() * 2 * Math.PI;
                    object.rotation.z = Math.random() * 2 * Math.PI;

                    object.scale.x = Math.random() * 2 + 1;
                    object.scale.y = Math.random() * 2 + 1;
                    object.scale.z = Math.random() * 2 + 1;

                    object.castShadow = true;
                    object.receiveShadow = true;
                    object.name = 'cube' + i;

                    scene.add(object);
                    objects.push(object);
                    // To do: Find a way to clear objs without breaking everything
                    // console.dir(objects);
                }
            }
            if (attention < 40) {
                for (var i = objects.length; i > attention; i--) {
                    scene.remove(objects[i]);
                }
            }
            if (testAttention > attention) {
                difference = testAttention - attention;
                console.log("\n\n\n" + "You're COOOOLING -" + difference + "\n\n");
                for (var i = 0; i < objects.length; i++) {
                    objects[i].material.transparent = true;
                    objects[i].material.opacity = 0.5;
                }

            }
            if (testAttention < attention) {
                difference = attention - testAttention;
                console.log('\n\n\n' + 'GAINERER!!! +' + difference + '\n\n\n');
                for (var i = 0; i < testAttention; i++) {
                    var object = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({ color: Math.random() * 0xffffff }));
                    object.position.x = Math.random() * 1000 - 500;
                    object.position.y = Math.random() * 600 - 300;
                    object.position.z = Math.random() * 800 - 400;

                    object.rotation.x = Math.random() * 2 * Math.PI;
                    object.rotation.y = Math.random() * 2 * Math.PI;
                    object.rotation.z = Math.random() * 2 * Math.PI;

                    object.scale.x = Math.random() * 2 + 1;
                    object.scale.y = Math.random() * 2 + 1;
                    object.scale.z = Math.random() * 2 + 1;

                    object.castShadow = true;
                    object.receiveShadow = true;
                    object.name = 'cube' + i;

                    scene.add(object);

                    objects.push(object);
                    // console.dir(objects);
                }
                // try to fade out? not working.
            }
            testAttention = attention;
            loopCount++;
        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        //

        function animate() {

            requestAnimationFrame(animate);

            render();
            stats.update();

        }

        function render() {
            controls.update();

            renderer.render(scene, camera);

        }

        function connectHeadset() {

        }

        //when the form is submitted
        $('form').submit(function(evt) {
                    evt.preventDefault(); //prevents the default action

                }
        </script>
    </div>
</body>

</html>